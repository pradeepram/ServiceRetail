<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>All Orders</title>
	<link rel="stylesheet" href="themes/JobSheet1.min.css" />
	<link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
	<link rel="stylesheet" href="Script/jquery.mobile.structure-1.4.5.min.css" />
	<script src="Script/jquery-1.11.2.js" type="text/javascript"></script>
	<script src="Script/jquery.mobile-1.4.5.min.js" type="text/javascript"></script>          
    <link rel="stylesheet" href="Script/jquery.dataTables.min.css"/>
    <script type="text/javascript" src="Script/jquery.dataTables.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {               
            $.ajax({
                type: "POST",
                contentType: "application/json; charset:utf-8",
                url: localStorage.getItem('WcfURL') + "/GetOrderDetails",
                data:"{}",
                dataType: "json",                
                async: true,
                cache: false,

                success: function(response) {
                    
                    var data = jQuery.parseJSON(response.d.toString());                
                    
                    if (data.NewDataSet.Table.length == undefined) {
                    var tr;
                    tr = $("<thead>");
                    tr.append("<tr><th style='text-align:left'>Job_ID</th><th style='text-align:left'>OrderDate</th><th style='text-align:left'>DueDate</th><th style='text-align:left'>Status</th></tr>"); // bind table header row
                    $("#OrderTable").append(tr);
                    tr.append("</thead>");
                    $("#OrderTable").append(tr);
                    
                    var tbody = $("<tbody>");
                    $("#OrderTable").append(tbody);
                    $("#OrderTable").append(tr);                    
                    
                        tr = $("<tr></tr>");
                        tr.append("<td><a href='#' data-rel='dialog' onclick='popup(" + data.NewDataSet.Table.Job_ID + ")'>" + data.NewDataSet.Table.Job_ID + "</a></td><td>" +
                            data.NewDataSet.Table.OrderDate + "</td><td>" +
                            data.NewDataSet.Table.DueDate + "</td><td>" +
                            data.NewDataSet.Table.Status + "</td>");

                        $("#OrderTable").append(tr);
                        
                    } else {
                    var tr;
                    tr = $("<thead>");
                    tr.append("<tr><th style='text-align:left'>Job_ID</th><th style='text-align:left'>OrderDate</th><th style='text-align:left'>DueDate</th><th style='text-align:left'>Status</th></tr>"); // bind table header row
                    $("#OrderTable").append(tr);
                    tr.append("</thead>");
                    $("#OrderTable").append(tr);
                    
                    var tbody = $("<tbody>");
                    $("#OrderTable").append(tbody);
                    $("#OrderTable").append(tr);                    
                    tr = $("<tr></tr>");
                        for (var i = 0; i < data.NewDataSet.Table.length; i++) {                        
                            tr = $("<tr></tr>");
                            tr.append("<td><a href='#popup' data-rel='dialog' onclick='popup(" + data.NewDataSet.Table[i].Job_ID + ")' >" + data.NewDataSet.Table[i].Job_ID + "</a></td><td>" +
                                data.NewDataSet.Table[i].OrderDate + "</td><td>" +
                                data.NewDataSet.Table[i].DueDate + "</td><td>" +
                                data.NewDataSet.Table[i].Status + "</td>");
                            $("#OrderTable").append(tr);                        
                        }
                    }
                    
                    $('#OrderTable').append(tbody); 
                    $('#OrderTable').dataTable({
                        "bInfo":false,
                        "bLengthChange":false,
                    }); 
                },
                error: function (response) {                                       
                }
            });                                                
        });
        function popup(e) {
            debugger;                                          
            localStorage.setItem('jobid', e);            
            $.ajax({
                type: "POST",
                contentType: "application/json; charset:utf-8",
                url: localStorage.getItem('WcfURL') + "/GetOrderStatusDetails",
                data:"{'jobid': '" + e + "'}",
                dataType: "json",                
                async: true,
                cache: false,

                success: function(response) {
                    
                    var data = jQuery.parseJSON(response.d.toString());                
                    
                    if (data.NewDataSet.Table.length == undefined) {
                    var tr;
                    tr = $("<thead>");
                    tr.append("<tr><th style='text-align:left'>Job_ID</th><th style='text-align:left'>Status</th><th style='text-align:left'>UpdatedDate</th></tr>"); // bind table header row
                    $("#ParticularJobTable").append(tr);
                    tr.append("</thead>");
                    $("#ParticularJobTable").append(tr);
                    
                    var tbody = $("<tbody>");
                    $("#ParticularJobTable").append(tbody);
                    $("#ParticularJobTable").append(tr);                    
                    
                        tr = $("<tr></tr>");
                        tr.append("<td>" + data.NewDataSet.Table.Job_ID + "</td><td>" +
                            data.NewDataSet.Table.Status + "</td><td>" +
                            data.NewDataSet.Table.UpdatedDate + "</td>");

                        $("#ParticularJobTable").append(tr);
                        
                    } else {
                    var tr;
                    tr = $("<thead>");
                    tr.append("<tr><th style='text-align:left'>Job_ID</th><th style='text-align:left'>Status</th><th style='text-align:left'>UpdatedDate</th></tr>"); // bind table header row
                    $("#ParticularJobTable").append(tr);
                    tr.append("</thead>");
                    $("#ParticularJobTable").append(tr);
                    
                    var tbody = $("<tbody>");
                    $("#ParticularJobTable").append(tbody);
                    $("#ParticularJobTable").append(tr);                    
                    tr = $("<tr></tr>");
                        debugger;
                        for (var i = 0; i < data.NewDataSet.Table.length; i++) {                        
                            tr = $("<tr></tr>");
                            tr.append("<td>"+ data.NewDataSet.Table[i].Job_ID +"</td><td>" +
                                data.NewDataSet.Table[i].Status + "</td><td>" +
                                data.NewDataSet.Table[i].UpdatedDate + "</td>");
                            $("#ParticularJobTable").append(tr);                        
                        }
                    }
                    
                    $('#ParticularJobTable').append(tbody); 
                    $('#ParticularJobTable').dataTable({
                        "bInfo": false,
                                    "bLengthChange": false,
                                    "bPaginate": false,
                                    "bFilter": false,
                                    "scrollX":true,
                                    "destroy": true
                    }); 
                },
                error: function (response) {                                       
                }
            });

        }   
                       
    </script>
    <style>        
    #refdocs_wrapper {
    display: inline-block;
    padding: 1px;
    border: 1px solid rgb(128,128,128);

    line-height: 18px;
}
#refdocs_button {
    padding: 0;
    height: 20px;
    width: 20px;
}
#refdocs_input{
    width: 154px;
    padding: 0px; 

    border: 0;
}
    
    </style>
</head>
<body >
    <div data-role="page" data-theme="a">
        <div data-role="header" data-position="fixed">
            <h1>Parsn Retail Watch Square</h1>               
            <a href="jobsheet.html" data-theme="a" data-inline="true" data-icon="home" data-iconpos="notext" data-direction="reverse" rel="external">Home</a>
            <a href="index.html"  data-theme="a" data-inline="true" data-icon="power" data-iconpos="notext" data-direction="reverse" rel="external">Logout</a>
            <div data-role="navbar" data-grid="d">		        
                <ul>
                    <li><a href="jobsheet.html" rel="external">Job Sheet</a></li>
                    <li><a href="Order_Details.html" rel="external" class="ui-btn-active">Order Details</a></li>
                    <li><a href="Service.htm" rel="external">Service</a></li>								
                    <li><a href="Company.html" rel="external">Company</a></li>
                    <li><a href="Invoice.html" rel="external">Invoice</a></li>
                </ul>
            </div>      
            <div data-role="navbar" data-grid="c">
                <ul>
                    <li><a href="Order_Details.html" rel="external" >All Orders</a></li>
                    <li><a href="Sort_Orders.html" rel="external">Delivery Due</a></li>				
                    <li><a href="AddToFollowUp.html" rel="external">Follow Up</a></li>	
                    <li><a href="Jeneology.html" rel="external" class="ui-btn-active">Jeneology</a></li>				
                </ul>
            </div>
        </div>
		
        <div data-role="content" >
            <form>	          
                <ul data-role="listview" data-inset="true">	                	                
                    <li data-role="fieldcontain">                        
                        <table  id="OrderTable"  class="table table-striped">	                        
                        </table>                                                                 
                        <!--<table  id="ParticularJobTable"  class="table table-striped">	                        
                        </table>         -->                                                        	          
                    </li>

                </ul>	           
            </form>		        
        </div>
        <div data-role="footer" data-position="fixed">
            <h4>Inventrace Powered By CAS</h4>
        </div>	        
    </div>
    <div data-role="page" id="popup">

	<div data-role="header" data-theme="e">
		<h1>Status Report</h1>
	</div><!-- /header -->

	<div data-role="content" data-theme="d">	
		  <ul data-role="listview" data-inset="true">		             
                         <table  id="ParticularJobTable"  class="table table-striped">	                        
                        </table>                                
		  </ul>							
	</div><!-- /content -->
	
	<div data-role="footer">
		<h4>Inventrace Powered By CAS</h4>
	</div><!-- /footer -->
</div><!-- /page popup -->
</body>
</html>