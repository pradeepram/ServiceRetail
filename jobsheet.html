<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>jobsheet</title>
	<link rel="stylesheet" href="themes/JobSheet1.min.css" />
	<link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
	<link rel="stylesheet" href="Script/jquery.mobile.structure-1.4.5.min.css" />
        <script src="Script/jquery-1.11.2.js" type="text/javascript"></script>
        <script src="Script/jquery.mobile-1.4.5.min.js" type="text/javascript"></script>      
     <script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.min.js"></script>
  <script type="text/javascript">
      $(document).ready(function() {
          var id = localStorage.getItem('customerid');
          var url = "jobsheet.html";
          debugger;
          $.ajax({
              type: "POST",
              contentType: "application/json; charset=utf-8",
              url: localStorage.getItem('WcfURL') + "/BindState",
              data: "{}",
              dataType: "json",
              success: function(data) {                  
                  $.each(data.d, function(key, value) {
                      $("#ddpState option[value='']").remove();
                      $("#ddpState").append($("<option></option>").val(value.State_Id).html(value.State_Name));
                      $("#ddpState")[0].selectedIndex = -1;
                  });
              },
              error: function(Result) {                  
              }
          });

          $.ajax({
              type: "POST",
              contentType: "application/json; charset=utf-8",
              url: localStorage.getItem('WcfURL') + "/BindBrand",
              data: "{}",
              dataType: "json",
              success: function(data) {
                  $.each(data.d, function(key, value) {
                      $("#ddpBrand").append($("<option></option>").val(value.BrandID).html(value.BrandName));
                      $("#ddpBrand option[value='']").remove();
                      $("#ddpBrand")[0].selectedIndex = -1;
                  });
              },
              error: function(Result) {                  
              }
          });

          $.ajax({
              type: "POST",
              contentType: "application/json; charset=utf-8",
              url: localStorage.getItem('WcfURL') + "/BindWarranty",
              data: "{}",
              dataType: "json",
              success: function(data) {
                  $.each(data.d, function(key, value) {
                      $("#ddpWarranty").append($("<option></option>").val(value.WarrantyID).html(value.WarrantyName));
                      $("#ddpWarranty option[value='']").remove();
                      $("#ddpWarranty")[0].selectedIndex = -1;
                  });
              },
              error: function(Result) {                  
              }
          });
          $.ajax({
              type: "POST",
              contentType: "application/json; charset=utf-8",
              url: localStorage.getItem('WcfURL') + "/BindJob",
              data: "{}",
              dataType: "json",
              success: function(data) {                  
                  $.each(data.d, function(key, value) {
                      $("#txtJobId").val(value.Job_ID);
                  });
              },
              error: function(Result) {                  
              }
          });
          $.ajax({
              type: "POST",
              contentType: "application/json; charset=utf-8",
              url: localStorage.getItem('WcfURL') + "/BindServiceEngg",
              data: "{}",
              dataType: "json",
              success: function(data) {                  
                  $.each(data.d, function(key, value) {
                      $("#ddpServiceEngg").append($("<option></option>").val(value.custrole).html(value.firstname));
                      $("#ddpServiceEngg option[value='']").remove();
                      $("#ddpServiceEngg")[0].selectedIndex = -1;
                  });
              },
              error: function(Result) {                  
              }
          });
          $("#submit").click(function(event) {
              $("#jobsheet").validate({
                  errorPlacement: function(error, element) {                      
                      error.appendTo("label[for=" + $(element).attr('id') + "]");
                  },
                  errorElement: "em"
              });              
              if ($("#jobsheet").valid()) {                 
                  var state = $('#ddpState option:selected').val();                 
                  var brand = $('#ddpBrand option:selected').val();
                  var model = $('#ddpModel option:selected').val();
                  var Warranty = $('#ddpWarranty option:selected').val();
                  var serviceengg = $('#ddpServiceEngg option:selected').val();
                  if (state == "" || brand == "" || model == "" || serviceengg == "" || Warranty=="") {
                      debugger;
                      alert("select the dropdown");
                  } else if (brand == "0" || model == "0") {
                      debugger;
                      $('#txtBrand').css('border-color', 'red');
                      $('#txtModel').css('border-color', 'red');                      
                      alert("Enter Brand and Model Name");                      
                  } 
                  else {
                      debugger;
                      $.ajax({
                          type: "POST",
                          contentType: "application/json; charset=utf-8",
                          url: localStorage.getItem('WcfURL') + "/JobSheet",                          
                          data: "{'phoneno':'" + parseInt($('#txtPhone').val(), 10) + "', 'job_id':'" + parseInt($('#txtJobId').val(), 10) + "', 'cust_name':'" + $('#txtCustName').val() + "', 'email':'" + $('#txtEmail').val() + "','address1':'" + $('#txtAddress1').val() + "', 'address2':'" + $('#txtAddress2').val() + "', 'city':'" + $('#txtCity').val() + "','state':'" + $('#ddpState option:selected').val() + "', 'pincode': '" + parseInt($('#txtPincode').val(), 10) + "','purchasedate':'" + $('#txtPurDate').val() + "', 'brand': '" + $('#ddpBrand  :selected').val() + "','brandddpname':'" + $('#ddpBrand option:selected').text() + "', 'brandname':'" + $('#txtBrand').val() + "','model':'" + $('#ddpModel  :selected').val() + "', 'modelddpname':'" + $('#ddpModel option:selected').text() + "', 'modelname':'" + $('#txtModel').val() + "', 'warranty':'" + $('#ddpWarranty option:selected').val() + "', 'problems':'" + $('#txtProblem').val() + "', 'remarks':'" + $('#txtRemarks').val() + "','serviveengg':'" + $('#ddpServiceEngg  :selected').val() + "', 'createdby':'" + localStorage.getItem('customerid') + "'}",
                          dataType: "json",
                          success: function(data) {
                              $.each(data.d, function(key, value) {
                                  if (value.result == "1") {                                      
                                      alert("success");                                      
                                      $(location).attr('href', url);
                                  } else {
                                      alert("Invalid Data");                                      
                                  }
                              });
                          },
                          error: function(data) {                              
                          }
                      });
                  }
              }
          });
          $("#clear").click(function(event) {
              debugger;
              location.reload(true);
          });
      }); 
  </script>
    <script type="text/javascript">
        function checkbrand(val) {                        
            if (val === "0") {
                document.getElementById('txtBrand').style.display = 'block';                
                document.getElementById('txtModel').style.display = 'block';                
            } else {
                document.getElementById('txtBrand').style.display = 'none';
                document.getElementById('txtModel').style.display = 'none';                
            }
            $('#ddpModel').empty();
            $('#ddpModel option:selected').removeAttr('selected');                        
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: localStorage.getItem('WcfURL') + "/BindModel",
                data: "{'BrandID': '" + $('#ddpBrand option:selected').val() + "'}",
                dataType: "json",
                success: function (data) {                    
                    $.each(data.d, function (key, value) {                        
                        $("#ddpModel").append($("<option value=''>select</option>").val(value.ModelID).html(value.ModelName));
                        $("#ddpModel option[value='']").remove();
                        $("#ddpModel")[0].selectedIndex = -1;
                    });
                },
                error: function (Result) {                    
                }
            });
        }
        function checkmodel(val) {
            debugger;
            var model;
            if (val === "0") {
                document.getElementById("txtModel").style.display = 'block';                
            } else
                document.getElementById('txtModel').style.display = 'none';

        }
        </script>
    <style>        
        #popupPanel-popup {
            right: 0 !important;
            left: auto !important;
}
#popupPanel {
    width: 200px;
    border: 1px solid #000;
    border-right:none;
    background: rgba(0,0,0,.5);
    margin: -1px 0;
}
#popupPanel .ui-btn {
    margin: 2em 15px;
}
    </style>
</head>
<body>
	<div data-role="page" data-theme="a">
		<div data-role="header" data-position="fixed" >
			<h1>Service Management</h1>
            <a href="jobsheet.html" data-transition="slide" data-theme="b" data-inline="true" data-icon="home" data-iconpos="notext" data-direction="reverse" rel="external">Home</a>
            <a href="index.html" data-transition="slide" data-theme="b" data-inline="true" data-icon="power" data-iconpos="notext" data-direction="reverse" rel="external">Logout</a>
            <div data-role="popup" id="popupPanel" data-corners="false" data-theme="none" data-shadow="false" data-tolerance="0,0">
				<button data-theme="a" data-icon="back" data-mini="true">Back</button>
				<button type="submit" data-theme="a" data-icon="grid" data-mini="true" onclick="'location.href = 'Service_Engineer.html''" >Service</button>
				<button  data-theme="a" data-icon="search" data-mini="true">Search</button>
			</div>
            <div data-role="navbar" data-grid="d">
			<ul>
				<li><a href="jobsheet.html" class="ui-btn-active">Job Sheet</a></li>
			    <li><a href="Order_Details.html" rel="external">Order details</a></li>
                <li><a href="Service.htm" rel="external">Service</a></li>								
				<li><a href="Company.html" rel="external">Manufacturer</a></li>
<li><a href="Invoice.html" rel="external">Invoice</a></li>
			</ul>
		</div>
		</div>
		<div data-role="content"  data-theme="a">
			<form id="jobsheet" method="POST" action="jobsheet.html">
  <ul data-role="listview" data-inset="true">
      <li data-role="fieldcontain">
    <label for="lblJobID">Job Id</label>
    <input id="txtJobId" type="text"   disabled>
  </li>
      <li data-role="fieldcontain">
    <label for="lblPhoneNo">Phone</label>
    <input required aria-required="true" class="required" type="number"  id="txtPhone" name="number">
  </li>
                    <li data-role="fieldcontain">
    <label for="lblCustName">Customer Name</label>
    <input type="text"  id="txtCustName" required>
  </li>
                    <li data-role="fieldcontain">            
    <label for="lblEmail">Email Id</label>
    <input type="email" name="email" id="txtEmail" value="" required >
  </li>
                        <li data-role="fieldcontain">
                             <label for="lblAddress1">Address</label>
    <input type="text" name="txtAddress1" id="txtAddress1" value="" required >    
  </li>
                    <li data-role="fieldcontain">
    <label for="lblCity">City</label>
    <input type="text"  id="txtCity"  name="city" required >
  </li>

                                <li data-role="fieldcontain">
    <label for="lblState">State</label>
                                    <select id="ddpState"  required>
                                        <option value="" selected>select</option>                   
                                    </select>        
  </li>
      <li data-role="fieldcontain">
          <label for="lblPincode">Pincode</label>
          <input  type="number" name="pincode" id="txtPincode" required>
      </li>
      <li data-role="fieldcontain">
	         <label for="date">Purchase Date</label>
	         <input type="date" name="date" id="txtPurDate"  required/>			
            </li>
      <li data-role="fieldcontain">
    <label for="lblBrand">Brand</label>
          <select  id="ddpBrand" onchange='checkbrand(this.value)'   required>
              <option value="" selected>select</option>                                   
          </select>
        <label for="exampleInputEmail1"></label>
        <input type="text" id="txtBrand" style='display:none'/>
  </li>
                <li data-role="fieldcontain">
    <label for="lblModel">Model</label>
                    <select id="ddpModel" onchange='checkmodel(this.value)' required>
                        <option value="" selected>select</option>                                   
                    </select>
                               <label for="exampleInputEmail1"></label>
        <input type="text" name="model" id="txtModel" style='display:none'/>
  </li>  
                <li data-role="fieldcontain">
    <label for="lblwarranty">Warranty</label>
                    <select id="ddpWarranty"  required>
                        <option value="" selected>select</option>                           
        
                    </select>
</li>
      <li data-role="fieldcontain">
          <label for="lblProblem">Problems</label>
          <textarea rows="5" style="resize:none" id="txtProblem" name="txtProblems" required></textarea>
      </li>
      <li data-role="fieldcontain">
          <label for="lblRemarks">Remarks</label>
          <textarea rows="5" style="resize:none" id="txtRemarks" name="txtRemarks" required></textarea>
      </li>
             <li data-role="fieldcontain">
    <label for="lblSE">Model</label>
                 <select id="ddpServiceEngg"  required>
                     <option value="" selected>select</option>                                   
                 </select>                               
  </li>  
      <li class="ui-body ui-body-b">
				<fieldset class="ui-grid-a">
					 <div class="ui-block-a"><input type="submit" name="Clear" id="clear" value="Clear" data-icon="alert" /></div>                  
                     <div class="ui-block-b"><input aria-required="true" class="required" data-theme=a type="submit" data-icon="check" name="submit" id="submit" value="Submit"></div>
			    </fieldset>
			</li>                
    </ul>
</form>
		</div>
        <div data-role="footer" data-position="fixed">
       <h4><a href="http://www.createalytics.com" data-rel="external">www.createalytics.com</a></h4>
    </div> 
	</div>
</body>
</html>