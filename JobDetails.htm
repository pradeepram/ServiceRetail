<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Service Engineer</title>   
	<link rel="stylesheet" href="themes/JobSheet1.min.css" />
	<link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
    <link rel="stylesheet" href="Script/jquery.mobile.structure-1.4.5.min.css" />
        <script src="Script/jquery-1.11.2.js" type="text/javascript"></script>
        <script src="Script/jquery.mobile-1.4.5.min.js" type="text/javascript"></script>      
    <script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.min.js"></script>  		
    <script type="text/javascript">
        $(document).ready(function () {
            //alert(localStorage.getItem('jobid'));
            $('#txtJobId').val(localStorage.getItem('jobid'));
            urlpage = "Order_Details.html";                    
            //$('#txtSearch').change(function () {            
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: localStorage.getItem('WcfURL') + "/OrderDetailList",
                data: "{'jobid': '" + localStorage.getItem('jobid') + "'}",

                dataType: "json",

                success: function (data) {
                    
                    $.each(data.d, function (key, value) {
                        

                        $("#txtPhone").val(value.phone);
                        $("#txtCustName").val(value.firstname);
                        $("#txtBrand").val(value.brand);
                        
                        $("#txtModel").val(value.model);
                        
                        $("#txtWarranty").val(value.warranty);
                        
                        $("#txtProblem").val(value.problem);
                        $("#txtComplaints").val(value.complaint);
                        $("#txtParts").val(value.parts);
                        $("#txtServiceCharge").val(value.servicecharge);
                        //$("input[type=radio]").attr('disabled', true);
                        $("#input[name=radio-choice-2]:checked").val(value.callconfirm);
                        if (value.callconfirm == "True") {
                            $("input[type=radio][value=0]").attr("checked", true);
                            //                            $("input[type=radio]").prop('checked', true);
                            //                            $('input:radio[name=radio-choice-2]')[0].checked = true;
                            //                            $('input:radio[name=radio-choice-2]').val("0");
                                                     $("input[type=radio]").prop('disabled', true);
                        } else {
                            
                            $("input[type=radio]").attr('disabled', false);
                        }
                        $("#txtCost").val(value.cost);
                    });
                },
                error: function (data) {                                        
                }

            });
            // });
            $("#submit").click(function (event) {
                $("#jobDetails").validate({
                    errorPlacement: function (error, element) {

                        //http://stackoverflow.com/questions/4844594/jquery-select-the-associated-label-element-of-a-input-field
                        error.appendTo("label[for=" + $(element).attr('id') + "]");
                    },
                    errorElement: "em"
                });
                if ($("#jobDetails").valid()) {
                    var servicecharge = $('#txtServiceCharge').val();
                    var callconfirm = $('input[name=radio-choice-2]:checked').val();
                    if (callconfirm == undefined) {
                        callconfirm = 0;
                        alert("check callconfirm");
                    }                   
                    else if (callconfirm == "" || servicecharge == "") {
                        $('input[name=radio-choice-2]:checked').css('border-color', 'red');
                        $('#txtServiceCharge').css('border-color', 'red');
                        alert("check callconfirm");
                    } else {
                        
                        $.ajax({
                            type: "POST",
                            contentType: "application/json; charset=utf-8",
                            url: localStorage.getItem('WcfURL') + "/UpdateStatus",
                            data: "{'callconfirm':'" + $('input[name=radio-choice-2]:checked').val() + "', 'job_id':'" + parseInt($('#txtJobId').val(), 10) + "','servicecharge':'" + $('#txtServiceCharge').val() + "','createdby': '" + localStorage.getItem('customerid') + "'}",
                            dataType: "json",
                            success: function(data) {
                                $.each(data.d, function (key, value) {
                                    if (value.result == "1") {                                        
                                        alert("success");
                                        $(location).attr('href', urlpage);
                                    } else {
                                        alert("Invalid Data");
                                    }
                                });
                            },
                            error: function(data) {                                                                
                            }
                        });
                    }
                }
            });
            $("#cancel").click(function (event) {                
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    url: localStorage.getItem('WcfURL') + "/CancelOrder",
                    data: "{'job_id':'" + parseInt($('#txtJobId').val(), 10) + "','createdby': '" + localStorage.getItem('customerid') + "'}",
                    dataType: "json",
                    success: function (data) {
                        $.each(data.d, function (key, value) {
                            if (value.result == "1") {                                
                                alert("success");
                                $(location).attr('href', urlpage);
                            } else {
                                alert("Invalid Data");
                            }
                        });
                    },
                    error: function (data) {                                                
                    }
                });
            });            
        });        
    </script>    
    <style> 
        #popupPanel-popup {
            right: 0 !important;
            left: auto !important;
}
#popupPanel {
    width: 200px;
    border: 1px solid #000;
    border-right:none;
    background: rgba(0,0,0,.5);
    margin: -1px 0;
}
#popupPanel .ui-btn {
    margin: 2em 15px;
}
    </style>
</head>
<body>
	<div data-role="page" data-theme="a">
		<div data-role="header" data-position="fixed" >
			<h1>Service Dept</h1>
            <a href="#popupPanel" data-rel="popup" data-transition="slide" data-position-to="window" data-theme="b" data-inline="true" data-icon="home" data-iconpos="notext" data-direction="reverse">Home</a>            
            <div data-role="navbar" data-grid="d">
			<ul>
				<li><a href="jobsheet.html" rel="external">Job Sheet</a></li>
		            <li><a href="Order_Details.html" rel="external"  >Order Details</a></li>
		            <li><a href="Service.htm" rel="external">Service</a></li>								
		            <li><a href="Company.html" rel="external">Company</a></li>
		            <li><a href="Invoice.html" rel="external">Invoice</a></li>
			</ul>
		</div>
		</div>
		<div data-role="content" data-theme="a">		
	<form id="jobDetails" method="POST" action="">
		  <ul data-role="listview" data-inset="true">
		      <li data-role="fieldcontain">
		          <label for="search">Job Id</label>
		          <input type="text" name="password" id="txtJobId" disabled/>
		      </li>
                                  <li data-role="fieldcontain">
    <label for="lblCustName">Customer Name</label>
    <input type="text"  id="txtCustName" name="txtCustname" disabled>
  </li>

	                        <li data-role="fieldcontain">
	                            <label for="search">Phone Number</label>
	                            <input type="text" name="password" id="txtPhone" value=""   disabled/>
	                        </li>            
	                        <li data-role="fieldcontain">
	                            <label for="name">Brand</label>
	                            <input type="text" name="name" id="txtBrand" value=""   disabled/>
	                        </li>
	                        <li data-role="fieldcontain">
	                            <label for="name">Model</label>
	                            <input type="text" name="name" id="txtModel" value=""   disabled/>
	                        </li>
	                        <li data-role="fieldcontain">
	                            <label for="name">Warranty</label>
	                            <input type="text" name="name" id="txtWarranty" value=""   disabled/>
	                        </li>
	                        <li data-role="fieldcontain">
	                            <label for="textarea">Problems</label>
	                            <textarea cols="40" rows="8" name="textarea" id="txtProblem"  disabled></textarea>
	                        </li>									
	                        <li data-role="fieldcontain">
	                            <label for="textarea">Complaints</label>
	                            <textarea cols="40" rows="8" name="textarea" id="txtComplaints"  disabled></textarea>
	                        </li>						
                            	<li data-role="fieldcontain">
	                            <label for="textarea">Parts</label>
	                            <textarea cols="40" rows="8" name="textarea" id="txtParts"  disabled></textarea>
                            	</li>	
                                <li data-role="fieldcontain">
	                            <label for="textarea">Service Charge</label>
                                    <!--<textarea cols="40" rows="8" name="textarea" id="txtServiceCharge"  required></textarea>-->
                                  <input type="number" name="txtServiceCharge" id="txtServiceCharge"  required/>	                        
                            	</li>
		      <li data-role="fieldcontain">
	                            <fieldset data-role="controlgroup">
	                                <legend>Call Confirm:</legend>
	                                <input type="radio" name="radio-choice-2" id="radio-choice-21" value="1" />
	                                <label for="radio-choice-21">Yes</label>

	                                <input type="radio" name="radio-choice-2" id="radio-choice-22" value="0"/>
	                                <label for="radio-choice-22">No</label>         	
                                    
                                    <input type="radio" name="radio-choice-2" id="radio-choice-23" value="2"/>
	                                <label for="radio-choice-23">Didn't PickUp</label>         	

	                            </fieldset>
	                        </li>	
	                        <li data-role="fieldcontain">
	                            <label for="name">Estimated Cost:</label>
	                            <input type="text" name="name" id="txtCost" disabled/>
	                        </li>            
	                        <li class="ui-body ui-body-b">
	                            <fieldset class="ui-grid-a">
	                                <div class="ui-block-a"><input aria-required="true" class="required" data-theme=a type="submit" data-icon="check" name="cancel" id="cancel" value="Cancel Order"></div>
	                                <div class="ui-block-b"><input aria-required="true" class="required" data-theme=a type="submit" data-icon="check" name="submit" id="submit" value="Update"></div>
	                            </fieldset>
	                        </li>			
	                    </ul>			
		</form>				
            </div>
        <div data-role="footer" data-position="fixed">
        <h4>Powered By CAS</h4>
    </div> 	
        </div>
</body>
</html>