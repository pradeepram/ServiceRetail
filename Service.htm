<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Service Engineer</title>   
	<link rel="stylesheet" href="themes/JobSheet1.min.css" />
	<link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
    <link rel="stylesheet" href="Script/jquery.mobile.structure-1.4.5.min.css" />
        <script src="Script/jquery-1.11.2.js" type="text/javascript"></script>
    <script src="Script/jquery.mobile-1.4.5.min.js" type="text/javascript"></script> 
    <link rel="stylesheet" href="Script/jquery.dataTables.min.css"/>
    <script type="text/javascript" src="Script/jquery.dataTables.min.js"></script>      
    <script type="text/javascript">
        $(document).ready(function () {            
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: localStorage.getItem('WcfURL') + "/BindServiceEngg",
                data: "{}",
                dataType: "json",
                success: function (data) {                    
                    $.each(data.d, function (key, value) {
                        $("#ddpServiceEngg").append($("<option></option>").val(value.custrole).html(value.firstname));
                        $("#ddpServiceEngg option[value='']").remove();
                        $("#ddpServiceEngg")[0].selectedIndex = -1;
                    });
                },
                error: function (Result) {                                        
                }
            });
            $("#ddpServiceEngg").change(function () {
                
                $("#OrderTable td").remove();
                $("#OrderTable tr").remove();
                $("#OrderTable th").remove();
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset:utf-8",
                    url: localStorage.getItem('WcfURL') + "/GetServiceOrderDetails",
                    data: "{'ServiceEngg': '" + $('#ddpServiceEngg  :selected').val() + "'}",
                    dataType: "json",
                    async: true,
                    cache: false,

                    success: function (response) {
                        
                        var data = jQuery.parseJSON(response.d.toString());
                        var tr;
                        tr = $("<tr></tr>");
                        tr.append("<th>Job_ID</th><th>BrandName</th><th>ModelName</th><th>Warranty</th><th>Call Confirm</th>"); // bind table header row
                        
                        $("#OrderTable").append(tr);
                        if (data.NewDataSet.Table.length == undefined) {
                            tr = $("<tr></tr>");
                            
                            tr.append("<td><a href='Service_Engineer.html' data-rel='popup' onclick='popup(" + data.NewDataSet.Table.Job_ID + ")'>" + data.NewDataSet.Table.Job_ID + "</a></td><td>" +
                                    data.NewDataSet.Table.BrandName + "</td><td>" +
                                    data.NewDataSet.Table.ModelName + "</td><td>" +
                                    data.NewDataSet.Table.Warranty + "</td><td>" +
                                    data.NewDataSet.Table.CallConfirm + "</td><td>");

                            $("#OrderTable").append(tr);
                            
                        }
                        else {

                            for (var i = 0; i < data.NewDataSet.Table.length; i++) {
                                
                                tr = $("<tr></tr>");

                                tr.append("<td><a href='Service_Engineer.html' data-rel='popup' onclick='popup(" + data.NewDataSet.Table[i].Job_ID + ")'>" + data.NewDataSet.Table[i].Job_ID + "</a></td><td>" +
                                    data.NewDataSet.Table[i].BrandName + "</td><td>" +
                                    data.NewDataSet.Table[i].ModelName + "</td><td>" +
                                    data.NewDataSet.Table[i].Warranty + "</td><td>" +
                                     data.NewDataSet.Table[i].CallConfirm + "</td><td>");

                                $("#OrderTable").append(tr);
                                
                            }
                        }
                        $("#OrderTable").dataTable();
                    },
                    error: function (response) {                                               
                    }
                });
            });
        });
        function popup(e) {            
            var url = "Service_Engineer.html";
            $('#txtJobId').val(e);
            localStorage.setItem('jobid', e);
            $(location).attr('href', url);
        }
    </script>    
    
</head>
<body>
		<div data-role="page" data-theme="a">
		<div data-role="header" data-position="fixed" >
			<h1>Service Dept</h1>
            <a href="#popupPanel" data-rel="popup" data-transition="slide" data-position-to="window" data-theme="b" data-inline="true" data-icon="home" data-iconpos="notext" data-direction="reverse">Home</a>
            <div data-role="popup" id="popupPanel" data-corners="false" data-theme="none" data-shadow="false" data-tolerance="0,0">
				<button data-theme="a" data-icon="back" data-mini="true">Back</button>
				<button data-theme="a" data-icon="grid" data-mini="true">Menu</button>
				<button data-theme="a" data-icon="search" data-mini="true">Search</button>
			</div>
		    <div data-role="navbar" data-grid="d">
		        <ul>
		            <li><a href="jobsheet.html" rel="external">Job Sheet</a></li>
		            <li><a href="Order_Details.html" rel="external">Order details</a></li>
		            <li><a href="Service.htm" class="ui-btn-active">Service</a></li>								
		            <li><a href="Company.html" rel="external">Manufacturer</a></li>
		            <li><a href="Invoice.html" rel="external">Invoice</a></li>
		        </ul>
		    </div>

		</div>
		<div data-role="content" data-theme="a">		
	<form id="servicesheet" method="POST" action="">
		<ul data-role="listview" data-inset="true">
		    <li data-role="fieldcontain">                        
        <label for="day">Service Engineer</label>
		        <select id="ddpServiceEngg" >
		            <option value="" selected>select</option>             
		        </select>                       
            </li>
		    <li data-role="fieldcontain">                        
            <table data-role="table" id="OrderTable"  class="ui-body-d ui-shadow table-stripe ui-responsive" data-column-btn-theme="b" 
	               data-column-btn-text="Columns">    
	        </table>   
          			</li>
		</ul>		
		</form>				
            </div>
        <div data-role="footer" data-position="fixed">
        <h4>Powered By CAS</h4>
    </div> 	
        </div>
</body>
</html>